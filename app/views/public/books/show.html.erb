<div class="page-title">
  <span><strong>Book details</strong></span>
</div>
<div class="books-show">

    <div class="books-show__books-info">
      <div class="books-show__books-image">
        <%= link_to (image_tag(@book.large_image_url)), @book.item_url, target: :_blank, rel: "noopener noreferrer" %>
      </div>
      <div class="books-show__books-info-items">
        <table>
          <tbody>
            <tr>
              <span>・タイトル</span><br>
              <span><%= @book.title %></span><br>

              <span>・著者</span><br>
              <span><%= @book.author %></span><br>
              <span>・商品説明</span><br>
              <span><%= @book.item_caption %></span><br>
              <span>・価格</span><br>
              <span>￥<%= @book.item_price %></span><br>
              <span>・出版社</span><br>
              <span><%= @book.publisher_name %></span><br>

              <span>・ジャンル</span><br><span><%= link_to @book.genre.name, genre_path(@book.genre.id) %></span><br>
              <span>・科目</span><br><span><%= link_to @book.subject.name, subject_path(@book.subject.id)%></span><br>
              <span>・投稿者<br><%= link_to @book.user.name, user_path(@book.user.id) %></span><br>
              <span>・購入した背景<br><%= @book.story %></span>
            </tr>
          </tbody>
        </table>

        <!--ブックマークボタン-->
        <% if @book.bookmarked_by?(current_user) %>
          <%= link_to "bookmarkから削除", book_bookmark_path(@book), method: :delete %><br>
        <% else %>
          <%= link_to "bookmarkに追加", book_bookmarks_path(@book), method: :post %><br>
        <% end %>

        <% if current_user == @book.user %>
          <%= link_to "編集", edit_book_path(@book), class:"btn btn-secondary" %>
        <% end %>
      </div>

    </div>
    <div class="books-show__books-comments-form">
      <p>コメントを新しい順で<%= @amount %>件表示（全<%= @amounts %>件）</p>
      <!--コメント投稿フォーム-->
      <%= form_with model:[@book,@comment], local: true do |f| %>
        <%= f.text_area :body, size:"60x3", rows:'3', placeholder: "コメントを入力" %>
        <p><%= f.submit "送信する" %></p>
      <% end %>

      <div class="books-show__books-comments">
        <!--コメント一覧-->
        <% if @comments.any? %>
          <% @comments.each do |comment| %>
            <div class="books-show__books-comments-items">
              <div class="books-show__books-user-info">
                <%= link_to user_path(comment.user_id) do %>
                  <%= attachment_image_tag comment.user, :profile_image, :fill, 50, 50, fallback: "no-image.jpeg", size: "40x40" %>
                  <%= comment.user.nick_name %>
                <% end %>
              </div>
              <div class="books-show__books-comments-body">
                <%= comment.body %><br>

                  <%= comment.created_at.to_s(:datetime) %>

                  <!--いいねボタン-->
                  <% if comment.liked_by?(current_user) %>
                    <%= link_to comment.likes.count, book_comment_like_path(@book,comment), method: :delete, class: "fas fa-heart heart_red" %>
                  <% else %>
                    <%= link_to comment.likes.count, book_comment_likes_path(@book,comment), method: :post, class: "fas fa-heart heart_blue" %>
                  <% end %>

                  <!--削除ボタン-->
                  <% if current_user == comment.user %>
                    <%= link_to "削除", book_comment_path(comment.book, comment), method: :delete %>
                  <% end %>

              </div>
            </div>
          <% end %>
          <% else %>
            <h4 class="text-center">No comment</h4>
          <% end %>


      </div>
      <div class="justify-content-center">
      <!--ページネーション-->
        <%= paginate @comments %>
      </div>
    </div>
</div>